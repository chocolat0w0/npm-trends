# 実装計画

## 1. プロジェクトセットアップ ✅ (2025-12-13 完了)

- Vite + React + TypeScript のテンプレートで骨組みを作成し、`src/main.tsx` にて `App` を描画する。
- グローバルスタイルとレスポンシブな 2 カラムレイアウト（デスクトップ）/ 縦積み（モバイル）を整備し、README / SPEC の UI 要件を満たす。

## 2. ドメインモデルとサービス層 ✅ (2025-12-13 完了)

- `src/types/DownloadSeries.ts` で API レスポンスとグラフ用データ構造を型定義する。
- `src/services/npmClient.ts` に fetch ラッパーを実装し、メモリキャッシュ・エラーハンドリング・300ms デバウンス制御を組み込む。

## 3. 状態管理

- Zustand ストア (`src/store/packagesStore.ts`) を用意し、`packages`, `datasets`, `status`, `errors` を保持する。
- 追加・削除・URL 初期化アクションと、グラフ描画向けのセレクター/派生データを実装する。

## 4. パッケージ入力/一覧 UI

- `src/components/PackageForm/PackageForm.tsx` で入力検証、trim + 小文字化、重複排除を行うフォームを構築。
- `PackageList` コンポーネントでカラーラベル付きチップを表示し、最新ダウンロード値・削除ボタン・ローディング表示を提供する。

## 5. URL クエリ同期

- `src/hooks/usePackageQuerySync.ts` などのフックで `?packages=<comma>` を `history.replaceState` 経由で同期する。
- 初期マウント時にクエリを解析してストアへ投入し、存在しないパッケージはエラー扱いでスキップする。

## 6. グラフ可視化

- `src/components/DownloadChart/DownloadChart.tsx` で Recharts を使った折れ線グラフを描画。
- パッケージごとにユニークカラーと凡例/ツールチップを提供し、データが無い場合は空状態メッセージを表示する。

## 7. 状態表示とアクセシビリティ

- パッケージ単位のスピナー、全体エラーバナー、欠損パッケージのアラート/トーストを整備。
- グラフや操作要素に `aria-label` などを付与し、コントラスト要件とフォーカス管理を満たす。

## 8. テスト戦略（全ステップ横断）

- 各ステップの実装と並行して該当領域のテストを作成・更新し、仕様逸脱を早期に検知する。
- npm クライアント、ストア、正規化ロジック、URL 同期フックの単体テストを必要な段階で追加する。
- Testing Library によるフォーム・一覧・グラフ挙動の結合テストも、該当ステップ完了時に随時補強し、CI では常時カバレッジ 80% 以上を目標とする。
